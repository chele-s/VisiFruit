{
  "system_info": {
    "name": "VisiFruit Prototipo - Sistema de Clasificación Inteligente",
    "version": "1.0.0",
    "mode": "prototype",
    "description": "Sistema de clasificación automática con IA, DRV8825 y MG995"
  },
  
 "camera_settings": {
  "type": "csi_camera",
  "name": "OV5647 Camera Module v1",
  "frame_width": 960,
  "frame_height": 720,
  "fps": 30,
  "auto_exposure": true,
  "auto_white_balance": true,
    "brightness": 0.0,
    "contrast": 1.15,
    "saturation": 1.05,
    "sharpness": 1.3,
    "rotation_degrees": -90,
    "flip_horizontal": false,
    "flip_vertical": false,
    "buffer_size": 2,
    "auto_start_capture": true,
    "fallback_to_mock": false,
    "image_enhancement": {
      "enabled": false,
      "auto_brightness": false,
      "auto_contrast": false,
      "equalize_histogram": false,
      "clahe_enabled": false,
      "clahe_clip_limit": 2.0,
      "clahe_tile_size": 8,
      "gamma_correction": 1.0,
      "denoise": false
    }
  },
  
  "ai_model_settings": {
    "model_path": "weights/best.pt",
    "model_type": "yolov8",
    "model_source": "Roboflow 3.0 Object Detection (Fast)",
    "confidence_threshold": 0.20,
    "iou_threshold": 0.45,
    "max_detections": 50,
    "input_size": 480,
    "device": "cpu",
    "num_threads": 4,
    "half_precision": false,
    "num_workers": 2,
    "class_names": ["apple", "pear", "lemon"],
    "_comment_resolution": "Cámara OV5647 captura en 960x720, YOLOv8 redimensiona a 480x480 internamente",
    "_comment_optimization": "input_size=480 para máxima velocidad en Raspberry Pi 5"
  },

  "remote_inference": {
    "enabled": true,
    "server_url": "http://192.168.137.1:9000",
    "auth_token": "visifruittoken2025",
    "health_endpoint": "/health",
    "infer_endpoint": "/infer",
    "connect_timeout_s": 0.5,
    "read_timeout_s": 2.0,
    "write_timeout_s": 1.0,
    "pool_timeout_s": 0.5,
    "max_retries": 1,
    "fallback_to_local": true,
    "jpeg_quality": 85,
    "max_dimension": 480,
    "auto_quality": true,
    "cb_failure_threshold": 3,
    "cb_timeout_seconds": 20.0,
    "cb_half_open_requests": 1,
    "_comment": "Configuración optimizada para cliente asíncrono HTTP/2 con circuit breaker"
  },
  
  "labeler_settings": {
    "enabled": true,
    "type": "stepper",
    "name": "Etiquetadora_Stepper",
    "step_pin_bcm": 19,
    "dir_pin_bcm": 26,
    "enable_pin_bcm": 21,
    "enable_active_low": true,
    "base_speed_sps": 1500,
    "max_speed_sps": 2000,
    "acceleration_sps2": 500,
    "step_pulse_us": 4,
    "microsteps": 1,
    "activation_duration_seconds": 0.6,
    "intensity_percent": 100.0,
    "activate_on_detection": false
  },
  
  "laser_stepper_settings": {
    "enabled": true,
    "type": "stepper",
    "name": "Stepper_Laser",
    "step_pin_bcm": 19,
    "dir_pin_bcm": 26,
    "enable_pin_bcm": 21,
    "enable_active_low": true,
    "base_speed_sps": 1500,
    "max_speed_sps": 2000,
    "acceleration_sps2": 500,
    "step_pulse_us": 4,
    "activation_duration_seconds": 0.6,
    "steps_per_revolution": 200,
    "microsteps": 1
  },
  
  "servo_settings": {
    "apple": {
      "pin_bcm": 12,
      "name": "Servo_Manzanas",
      "category": "apple",
      "min_pulse_us": 1000,
      "max_pulse_us": 2000,
      "default_angle": 180,
      "activation_mode": "absolute",
      "activation_angle": 90,
      "activation_duration_s": 2.0,
      "hold_duration_s": 1.5,
      "return_smoothly": true,
      "invert": false,
      "_comment": "GPIO 12 (PWM0 - Hardware PWM) - Clasificador manzanas: 180° reposo (sin detector) / 90° actuación (cuando detecta)"
    },
    "pear": {
      "pin_bcm": 13,
      "name": "Servo_Peras",
      "category": "pear",
      "min_pulse_us": 1000,
      "max_pulse_us": 2000,
      "default_angle": 150,
      "activation_mode": "absolute",
      "activation_angle": 100,
      "activation_duration_s": 2.0,
      "hold_duration_s": 1.5,
      "return_smoothly": true,
      "invert": false,
      "_comment": "GPIO 13 (PWM1 - Hardware PWM) - Clasificador peras: 150° reposo (cuando no detecta) / 100° actuación (cuando detecta)"
    },
    "lemon": {
      "pin_bcm": 20,
      "name": "Servo_Limones",
      "category": "lemon",
      "min_pulse_us": 1000,
      "max_pulse_us": 2000,
      "default_angle": 90,
      "activation_mode": "absolute",
      "activation_angle": 10,
      "activation_duration_s": 2.0,
      "hold_duration_s": 1.5,
      "return_smoothly": true,
      "invert": false,
      "_comment": "GPIO 20 (Software PWM via gpiozero) - Clasificador limones: 90° reposo / 10° actuación (cuando detecta). GPIO 19 ocupado por stepper."
    }
  },
  
  "belt_settings": {
    "relay1_pin": 22,
    "relay2_pin": 23,
    "motor_pin_bcm": -1,
    "enable_pin_bcm": -1,
    "direction_pin_bcm": -1,
    "direction_pin2_bcm": -1,
    "speed_control_pin": -1,
    "default_direction": "forward",
    "start_delay_s": 0.5,
    "use_advanced_controller": true,
    "control_type": "relay_motor",
    "enable_pin": 27,
    "active_state_on": "LOW",
    "default_speed_percent": 100,
    "safety_timeout_s": 0
  },
  
  "sensor_settings": {
    "trigger_sensor": {
      "enabled": true,
      "type": "mh_flying_fish",
      "name": "MH_FlyingFish",
      "pin_bcm": 4,
      "trigger_level": "falling",
      "trigger_on_state": "LOW",
      "debounce_time_ms": 50,
      "pull_up_down": "PUD_UP"
    },
    "bin_level_sensors": {}
  },

  "sensor_behavior": {
    "resume_belt_on_trigger": true,
    "disable_belt_safety_timeout_on_trigger": true,
    "labeler_activation_on_trigger": {
      "enabled": true,
      "duration_s": 0.5,
      "intensity_percent": 30.0
    },
    "actuate_all_sections_after_delay": {
      "enabled": false,
      "delay_s": 2.5,
      "activation_duration_s": 5.0
    }
  },

  "dedup_settings": {
    "enabled": true,
    "iou_threshold": 0.3,
    "time_window_s": 3.0,
    "center_distance_px": 100,
    "per_class_cooldown_s": 2.5,
    "max_events_per_frame": 1
  },
  
  "timing": {
    "belt_speed_mps": 0.2,
    "sensor_to_camera_distance_m": 0.1,
    "camera_to_labeler_distance_m": 0.12,
    "camera_to_classifier_distance_m": 0.5,
    "min_detection_interval_s": 0.15,
    "min_servo_activation_interval_s": 2.0
  },
  
  "safety": {
    "emergency_stop_enabled": true,
    "max_continuous_activations": 10,
    "overheat_protection": true,
    "max_temperature_c": 70,
    "watchdog_timeout_s": 30
  },
  
  "logging": {
    "level": "INFO",
    "log_to_file": true,
    "log_file": "logs/prototipo_clasificador.log",
    "max_log_size_mb": 50,
    "backup_count": 5,
    "log_performance": true
  },
  
  "advanced": {
    "use_gpiozero": true,
    "use_pigpio": false,
    "test_on_init": false,
    "enable_statistics": true,
    "statistics_interval_s": 10,
    "save_detections": false,
    "detections_path": "logs/detections/"
  },
  
  "debug": {
    "show_preview": false,
    "save_annotated_frames": false,
    "preview_window": "VisiFruit - Preview",
    "no_detection_log_interval_s": 60.0,
    "drm_preview": true,
    "http_preview": true,
    "http_preview_port": 8081
  },
  
  "calibration": {
    "servo_calibration_angles": [0, 45, 90, 135, 180],
    "labeler_test_duration_s": 1.0,
    "camera_warmup_frames": 10,
    "ai_warmup_iterations": 5
  },
  
  "api_settings": {
    "enabled": true,
    "host": "0.0.0.0",
    "port": 8000,
    "_comment": "API REST para control del sistema desde frontend. Puerto 8000 para compatibilidad con sistema principal."
  }
}
